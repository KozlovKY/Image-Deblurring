defaults:
  - _self_

seed: 42

data:
  # Корневая директория с данными; внутри ожидаются подпапки "blur" и "sharp".
  # Можно переопределять из CLI: python train.py data.data_dir="path/to/data"
  data_dir: "data"
  blur_dir: "${data.data_dir}/blur"
  sharp_dir: "${data.data_dir}/sharp"
  batch_size: 16
  num_workers: 8
  val_split: 0.2
  pin_memory: true
  drop_last: true

model:
  # Lightning-модуль деблюринга c EVSSM внутри
  _target_: src.training.lit_module.LitDeblurring
  model_name: "evssm"
  net:
    _target_: src.models.evssm.EVSSM
    inp_channels: 3
    out_channels: 3
    dim: 16
    num_blocks: [6, 6, 12]
    num_refinement_blocks: 4
    ffn_expansion_factor: 3
    bias: false
  optimizer_cfg:
    _target_: torch.optim.Adam
    lr: 5e-4
  scheduler_cfg:
    _target_: torch.optim.lr_scheduler.ReduceLROnPlateau
    mode: "min"
    patience: 5
    factor: 0.5

train:
  epochs: 150
  device: "cuda"  # или "cpu"
  save_dir: "models"

logging:
  mlflow:
    enable: true
    tracking_uri: "http://127.0.0.1:8080"
    experiment_name: "image-deblurring"

data_module:
  _target_: src.training.datamodule.DeblurDataModule
  data_dir: ${data.data_dir}
  batch_size: ${data.batch_size}
  num_workers: ${data.num_workers}
  pin_memory: ${data.pin_memory}
  drop_last: ${data.drop_last}

trainer:
  _target_: lightning.pytorch.trainer.Trainer
  max_epochs: ${train.epochs}
  accelerator: "auto"
  devices: 1
  default_root_dir: ${train.save_dir}
  log_every_n_steps: 10

callbacks:
  model_checkpoint:
    _target_: lightning.pytorch.callbacks.ModelCheckpoint
    monitor: "val_loss"
    mode: "min"
    save_top_k: 3
    save_last: true
    filename: "epoch={epoch:03d}-val_loss={val_loss:.4f}"
    auto_insert_metric_name: false
    dirpath: "${train.save_dir}/checkpoints"

  lr_monitor:
    _target_: lightning.pytorch.callbacks.LearningRateMonitor
    logging_interval: "epoch"

mlflow_logger:
  _target_: lightning.pytorch.loggers.MLFlowLogger
  experiment_name: ${logging.mlflow.experiment_name}
  tracking_uri: ${logging.mlflow.tracking_uri}
